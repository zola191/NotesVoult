#CSharpInterviewFlashcards

## 1. Что такое Garbage Collector
?
# Garbage Collector в C#

## Основные понятия
- **GC** — автоматический менеджер памяти в .NET, освобождающий объекты, которые больше не используются.
- **Поколения (Generations)**:
  - **Gen 0**: Короткоживущие объекты (сборка происходит чаще).
  - **Gen 1**: Буфер между Gen 0 и Gen 2.
  - **Gen 2**: Долгоживущие объекты (например, статические поля).
  - **LOH (Large Object Heap)**: Объекты > 85 КБ (собираются только при полной сборке).

## Как работает GC?
1. **Пометка (Marking)**: GC обходит граф объектов, помечая используемые.
2. **Очистка (Sweeping)**: Удаляет непомеченные объекты.
3. **Компактификация (Compacting)**: Уменьшает фрагментацию (кроме LOH).

## Типы сборок
- **Неполная (Ephemeral)**: Только Gen 0 и Gen 1.
- **Полная (Full)**: Все поколения + LOH.
- **Фоновая (Background)**: Параллельная сборка (Gen 0 и Gen 1 не блокируют поток).
- **Блокирующая (Blocking)**: Приостанавливает все потоки.

## Настройки GC
```csharp
// Включение фоновой сборки (по умолчанию для .NET Core+)
GC.TryStartNoGCRegion(100_000); // Временное отключение GC

// Принудительная сборка (не рекомендуется в продакшене)
GC.Collect(2, GCCollectionMode.Forced, blocking: true);
```
## Ключевые термины

- **Корни (Roots)**: Статические поля, локальные переменные, регистры.
    Это объекты, которые GC считает "живыми" (не подлежащими удалению). Они служат точками входа для анализа графа объектов.
```csharp
	static List<string> _cache = new List<string>(); // Корень

	void Method() 
{
    var temp = new object(); // Корень, пока метод выполняется
}

```

1. **Регистры процессора**
	- Временные ссылки в стеке вызовов (например, параметры методов).


- **Финализация**: Вызов `Finalize` перед удалением (может замедлить GC).
    
- **IDisposable**: Паттерн для ручного освобождения ресурсов (например, файловые потоки).


## **Чем отличаются поколения в GC?**

Поколения оптимизируют работу GC, уменьшая частоту полных сборок.

| Поколение | Описание                    | Частота сборки                        | Примеры                      |
| --------- | --------------------------- | ------------------------------------- | ---------------------------- |
| **Gen 0** | Новые объекты               | Часто (~каждый 1-2 МБ)                | Локальные переменные         |
| **Gen 1** | "Буфер" между Gen 0 и Gen 2 | Реже (~после нескольких сборок Gen 0) | Объекты, пережившие 1 сборку |
| **Gen 2** | Долгоживущие объекты        | Редко (при нехватке памяти)           | Статические поля, кэши       |
| **LOH**   | Объекты > 85 КБ             | Только при Full GC                    | Большие массивы, XML-данные  |

**Ключевое правило:**  
Чем выше поколение, тем дороже его сборка. Gen 0 — быстрый, Gen 2 и LOH — могут вызывать задержки.

## **Что такое LOH и какие проблемы с ним связаны?**

**LOH (Large Object Heap)** — куча для больших объектов (> 85 КБ).

**Особенности:**

- Не компактифицируется (возникает фрагментация).
    
- Собирается только при **Full GC** (Gen 2 + LOH).
    
- Частые аллокации в LOH могут привести к `OutOfMemoryException`.






